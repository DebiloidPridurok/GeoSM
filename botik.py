from telegram import ReplyKeyboardMarkup, ReplyKeyboardRemove, Update
from telegram.ext import (
    Application,
    CommandHandler,
    ContextTypes,
    ConversationHandler,
    MessageHandler,
    filters,
)
import sqlite3
import logging
import os
from pathlib import Path

# ====== –ù–ê–°–¢–†–û–ô–ö–ê –ü–£–¢–ò –ö –ë–ê–ó–ï –î–ê–ù–ù–´–• ======
DB_FOLDER = Path(r"//mnt/windows_share")  # –º–æ–π –ø—É—Ç—å
DB_FOLDER.mkdir(parents=True, exist_ok=True)  # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
DB_PATH = DB_FOLDER / "bot_messages.db"  # –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –ë–î

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", 
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# –°–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞
CATEGORY, QUESTION = range(2)

# –î–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ (12 –∫–∞—Ç–µ–≥–æ—Ä–∏–π + –≤–æ–ø—Ä–æ—Å—ã)
bot_data = {
    "–°–∫–ª–∞–¥": {
        "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —è –æ–ø–æ–∑–¥–∞–ª(–¥–æ —á–∞—Å–∞)?": "üîπ **–û—Ç–≤–µ—Ç:** –ü—Ä–∏ –æ–ø–æ–∑–¥–∞–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ì–ö –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É—é—Ç –æ–± —ç—Ç–æ–º —Å–≤–æ–∏—Ö —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π.  –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –û–ö–ö —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –æ–ø–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ —Å–∏—Å—Ç–µ–º—ã –°–ö–£–î. –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –û–ö–ö –¥–µ–ª–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–∏—Å–µ–º –ø–æ —Ñ–∞–∫—Ç–∞–º –æ–ø–æ–∑–¥–∞–Ω–∏–π –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –∏ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –æ—Ç—á–µ—Ç–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å –ü2-01 ¬´–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã¬ª.",
        "–Ø –ø–æ—Ç–µ—Ä—è–ª –ø—Ä–æ–ø—É—Å–∫": "üîπ **–û—Ç–≤–µ—Ç:** –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø–æ—Ç–µ—Ä—è–ª/–∑–∞–±—ã–ª –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∫–∞—Ä—Ç—É –¥–æ—Å—Ç—É–ø–∞, —Ç–æ –æ–Ω –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –Ω–∞ –ø–ª–æ—â–∞–¥–∫—É/–≤ –æ—Ñ–∏—Å –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –ì–ö. –ü–æ –ø—Ä–∏—Ö–æ–¥—É –Ω–∞ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –°–ó, –≤—ã–±—Ä–∞–≤ –≤ –ü–û 1–° –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–°–ª—É–∂–µ–±–Ω—ã–µ –∑–∞–ø–∏—Å–∫–∏¬ª —à–∞–±–ª–æ–Ω: ¬´–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–¥–∞—á—É –ø—Ä–æ–ø—É—Å–∫–∞ (–±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã)¬ª. –í –¥–∞–Ω–Ω—É—é –°–ó —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤–Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞—Ç—É, —Ñ–∞–º–∏–ª–∏—é, –∏–Ω–∏—Ü–∏–∞–ª—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –≤–º–µ—Å—Ç–µ —Å –∫–æ—Ç–æ—Ä—ã–º –æ–Ω –≤–æ—à–µ–ª –≤ –æ—Ñ–∏—Å –∏–ª–∏ —á—å—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∫–∞—Ä—Ç—É –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø—Ä–∏ –≤—Ö–æ–¥–µ, –∑–∞—Ç–µ–º –ª–∏—á–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –≤ –î–£–ü –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–π –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã. –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∏ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏–µ–π –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. ",
        "–Ø –∑–∞–±–æ–ª–µ–ª, –Ω–æ —Å–º–æ–≥—É –≤—ã–∑–¥–æ—Ä–æ–≤–µ—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 2—Ö –¥–Ω–µ–π": "üîπ **–û—Ç–≤–µ—Ç:**  –ï—Å–ª–∏ –≤—ã –∑–∞–±–æ–ª–µ–≤–∞–µ—Ç–µ –∏ –Ω–µ –±–µ—Ä–µ—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–æ–ª—å–Ω–∏—á–Ω—ã–π, —Ç–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–ø—É—Å–∫. –°–æ—Ç—Ä—É–¥–Ω–∏–∫—É, –±–µ—Ä—É—â–µ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π, –ª–∏–±–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ—Ö –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Ü –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –µ—Å–ª–∏ –≤—ã –∑–∞–±–æ–ª–µ–≤–∞–µ—Ç–µ –∏ –Ω–µ –±–µ—Ä–µ—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–æ–ª—å–Ω–∏—á–Ω—ã–π, —Ç–æ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–ø—É—Å–∫. –°–æ—Ç—Ä—É–¥–Ω–∏–∫—É, –±–µ—Ä—É—â–µ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π, –ª–∏–±–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ—Ö –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Ü –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏: —á–µ—Ä–µ–∑ WhatsApp- —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ –∫–∞–¥—Ä–∞–º - 8 (962) 511-13-71;- –û–ö–ö - 8 (960) 198-07-72;–ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º- –∫–æ–ª–ª-—Ü–µ–Ω—Ç—Ä (–¥–ª—è –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏); –ª–∏–±–æ —É–≤–µ–¥–æ–º–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ì–ö —á–µ—Ä–µ–∑ –æ–±—â–∏–π —á–∞—Ç GeoSM –≤ Rocket.Chat. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Å–µ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.:—á–µ—Ä–µ–∑ WhatsApp- —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ –∫–∞–¥—Ä–∞–º - 8 (962) 511-13-71;- –û–ö–ö - 8 (960) 198-07-72;–ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º- –∫–æ–ª–ª-—Ü–µ–Ω—Ç—Ä (–¥–ª—è –æ—Ç–¥–µ–ª–∞ –ø—Ä–æ–¥–∞–∂, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏); –ª–∏–±–æ —É–≤–µ–¥–æ–º–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ì–ö —á–µ—Ä–µ–∑ –æ–±—â–∏–π —á–∞—Ç GeoSM –≤ Rocket.Chat. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Å–µ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.",
   "–ú–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–π—Ç–∏ —Ä–∞–Ω—å—à–µ —Å —Ä–∞–±–æ—Ç—ã": "üîπ **–û—Ç–≤–µ—Ç:** –í —Å–ª—É—á–∞–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è —Ä–∞–Ω–µ–µ –ø–æ–ª–æ–∂–µ–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –°–ó –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–ø—É—Å–∫ –Ω–∞ —Ç–æ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –Ω—É–∂–µ–Ω." },
    "–ó–∞–∫—É–ø–∫–∏": {
        "–ú–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–π—Ç–∏ —Ä–∞–Ω—å—à–µ —Å —Ä–∞–±–æ—Ç—ã": "üîπ **–û—Ç–≤–µ—Ç:** –¢–û–ü-3:\n1. ¬´–ü–∞–ø–∞ –î–∂–æ–Ω—Å¬ª (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è)\n2. ¬´DoDo Pizza¬ª (—Ç–æ–Ω–∫–æ–µ —Ç–µ—Å—Ç–æ)\n3. ¬´–ü–∏—Ü—Ü–∞ 22 —Å–º¬ª (–∞–≤—Ç–æ—Ä—Å–∫–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã)",
        "–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –ø–∞—Å—Ç—É –∫–∞—Ä–±–æ–Ω–∞—Ä–∞?": "üîπ **–†–µ—Ü–µ–ø—Ç:**\n1. –û–±–∂–∞—Ä—å—Ç–µ –ø–∞–Ω—á–µ—Ç—Ç—É\n2. –î–æ–±–∞–≤—å—Ç–µ —è–∏—á–Ω—ã–µ –∂–µ–ª—Ç–∫–∏ + –ø–∞—Ä–º–µ–∑–∞–Ω\n3. –°–º–µ—à–∞–π—Ç–µ —Å –≥–æ—Ç–æ–≤—ã–º–∏ —Å–ø–∞–≥–µ—Ç—Ç–∏\n4. –ü–æ–¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–∑—É!",
    },
    "–û–ü–ü": {
        "–ö–∞–∫ –ø–æ–º–µ–Ω—è—Ç—å –º–∞—Å–ª–æ?": "üîπ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:**\n1. –ü—Ä–æ–≥—Ä–µ–π—Ç–µ –¥–≤–∏–≥–∞—Ç–µ–ª—å 5 –º–∏–Ω\n2. –°–ª–µ–π—Ç–µ —Å—Ç–∞—Ä–æ–µ –º–∞—Å–ª–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–∫—É\n3. –ó–∞–ª–µ–π—Ç–µ –Ω–æ–≤–æ–µ (5W-30 –∏–ª–∏ 0W-20)\n4. –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä",
        "–ü–æ—á–µ–º—É –≥–æ—Ä–∏—Ç Check Engine?": "üîπ **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**\n1. –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å –¥–∞—Ç—á–∏–∫–∞ –∫–∏—Å–ª–æ—Ä–æ–¥–∞\n2. –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º\n3. –ë–µ–¥–Ω–∞—è/–±–æ–≥–∞—Ç–∞—è —Ç–æ–ø–ª–∏–≤–Ω–∞—è —Å–º–µ—Å—å\nüî∏ *–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞*",
    },
    "–Æ–†–û": {
        "–ö–∞–∫ –≤—ã—É—á–∏—Ç—å Python?": "üîπ **–°–æ–≤–µ—Ç—ã:**\n1. –ù–∞—á–Ω–∏—Ç–µ —Å –æ—Å–Ω–æ–≤ –Ω–∞ Stepik/Coursera\n2. –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—å –Ω–∞ LeetCode\n3. –ß–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é\n4. –ü–∏—à–∏—Ç–µ —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã",
        "–ß—Ç–æ —Ç–∞–∫–æ–µ API?": "üîπ **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**\nAPI (Application Programming Interface) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Å–æ–±–æ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –ø–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞.",
    },
    "–û–ü –ú–°–ö": {
        "–ö–∞–∫ –ø—Ä–æ—á–∏—Å—Ç–∏—Ç—å —Ç—Ä—É–±—ã?": "üîπ **–°–ø–æ—Å–æ–±—ã:**\n1. –•–∏–º–∏—è (¬´–ö—Ä–æ—Ç¬ª, ¬´–ú–∏—Å—Ç–µ—Ä –ú—É—Å–∫—É–ª¬ª)\n2. –í–∞–Ω—Ç—É–∑ (–º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞)\n3. –°–∞–Ω—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç—Ä–æ—Å (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞—Å–æ—Ä–æ–≤)",
        "–ö–∞–∫ –ø–æ–∫–ª–µ–∏—Ç—å –æ–±–æ–∏?": "üîπ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:**\n1. –í—ã—Ä–æ–≤–Ω—è–π—Ç–µ —Å—Ç–µ–Ω—ã —à–ø–∞–∫–ª–µ–≤–∫–æ–π\n2. –ù–∞–Ω–µ—Å–∏—Ç–µ –∫–ª–µ–π –Ω–∞ –ø–æ–ª–æ—Ç–Ω–æ\n3. –†–∞–∑–≥–ª–∞–¥—å—Ç–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –∫ –∫—Ä–∞—è–º\n4. –û–±—Ä–µ–∂—å—Ç–µ –∏–∑–ª–∏—à–∫–∏",
    },
    "–û–ö–ö": {
        "–ö–∞–∫ –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É?": "üîπ **–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**\n1. –û—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ 20-30% –¥–æ—Ö–æ–¥–∞\n2. –ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ ETF (–Ω–∞–ø—Ä–∏–º–µ—Ä, S&P 500)\n3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥ —Å –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π\n4. –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã",
        "–ì–¥–µ –≤–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç –ø–æ–¥ –Ω–∏–∑–∫–∏–π %?": "üîπ **–í–∞—Ä–∏–∞–Ω—Ç—ã:**\n1. –°–±–µ—Ä–±–∞–Ω–∫ (–æ—Ç 8.9% –≥–æ–¥–æ–≤—ã—Ö)\n2. –¢–∏–Ω—å–∫–æ—Ñ—Ñ (–æ–Ω–ª–∞–π–Ω-–∑–∞—è–≤–∫–∞)\n3. –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ (–¥–ª—è –∑–∞—Ä–ø–ª–∞—Ç–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)",
    },
    "–ù–≠–ü": {
        "–ö—É–¥–∞ –ø–æ–µ—Ö–∞—Ç—å –≤ –¢—É—Ä—Ü–∏–∏?": "üîπ **–ú–∞—Ä—à—Ä—É—Ç:**\n1. –°—Ç–∞–º–±—É–ª (–ê–π—è-–°–æ—Ñ–∏—è, –ì–æ–ª—É–±–∞—è –º–µ—á–µ—Ç—å)\n2. –ö–∞–ø–ø–∞–¥–æ–∫–∏—è (–≤–æ–∑–¥—É—à–Ω—ã–µ —à–∞—Ä—ã)\n3. –ê–Ω—Ç–∞–ª–∏—è (–ø–ª—è–∂–∏ –ö–ª–µ–æ–ø–∞—Ç—Ä—ã)",
        "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —à–µ–Ω–≥–µ–Ω—Å–∫—É—é –≤–∏–∑—É?": "üîπ **–î–æ–∫—É–º–µ–Ω—Ç—ã:**\n1. –ó–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç\n2. –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (–ø–æ–∫—Ä—ã—Ç–∏–µ ‚Ç¨30k+)\n3. –ë—Ä–æ–Ω—å –æ—Ç–µ–ª—è\n4. –í—ã–ø–∏—Å–∫–∞ —Å —Ä–∞–±–æ—Ç—ã\n5. –§–æ—Ç–æ 3.5√ó4.5 —Å–º",
    },
    "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ": {
        "–ö–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –ï–ì–≠?": "üîπ **–ü–ª–∞–Ω:**\n1. –†–µ—à–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ ¬´–†–µ—à—É–ï–ì–≠¬ª\n2. –†–∞–∑–±–∏—Ä–∞–π—Ç–µ –æ—à–∏–±–∫–∏ —Å —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–º\n3. –ü–∏—à–∏—Ç–µ —ç—Å—Å–µ –ø–æ —à–∞–±–ª–æ–Ω—É\n4. –£—á–∏—Ç–µ —Ç–µ–æ—Ä–∏—é –ø–æ —Ç–µ–º–∞–º",
        "–ì–¥–µ —É—á–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞?": "üîπ **–í–∞—Ä–∏–∞–Ω—Ç—ã:**\n1. –í–£–ó—ã: –ú–§–¢–ò, –í–®–≠, –°–ü–±–ì–£\n2. –û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã: –Ø–Ω–¥–µ–∫—Å.–ü—Ä–∞–∫—Ç–∏–∫—É–º, Hexlet\n3. –ó–∞—Ä—É–±–µ–∂–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã (MIT, Stanford)",
    },
    "–û–ü –ù–ù": {
        "–ö–∞–∫ —Å–±–∏—Ç—å –≤—ã—Å–æ–∫—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É?": "üîπ **–ú–µ—Ç–æ–¥—ã:**\n1. –ü–∞—Ä–∞—Ü–µ—Ç–∞–º–æ–ª (1 —Ç–∞–±–ª–µ—Ç–∫–∞)\n2. –û–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç—å–µ (–≤–æ–¥–∞, –º–æ—Ä—Å)\n3. –ü—Ä–æ—Ö–ª–∞–¥–Ω—ã–π –∫–æ–º–ø—Ä–µ—Å—Å –Ω–∞ –ª–æ–±\nüî∏ *–ï—Å–ª–∏ >39¬∞C ‚Äî –≤—ã–∑—ã–≤–∞–π—Ç–µ –≤—Ä–∞—á–∞*",
        "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø—Ä–æ—Å—Ç—É–¥–µ?": "üîπ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**\n1. –ü–æ—Å—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º\n2. –ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º –∏ –º–µ–¥–æ–º\n3. –ü—Ä–æ–º—ã–≤–∞–Ω–∏–µ –Ω–æ—Å–∞ —Å–æ–ª–µ–≤—ã–º —Ä–∞—Å—Ç–≤–æ—Ä–æ–º\n4. –í–∏—Ç–∞–º–∏–Ω C (1000 –º–≥/–¥–µ–Ω—å)",
    },
    "Call-–¶–µ–Ω—Ç—Ä": {
        "–ì–¥–µ –∫—É–ø–∏—Ç—å PS5 –¥–µ—à–µ–≤–ª–µ?": "üîπ **–ú–∞–≥–∞–∑–∏–Ω—ã:**\n1. DNS (–∞–∫—Ü–∏–∏ –≤ —á–µ—Ä–Ω—É—é –ø—è—Ç–Ω–∏—Ü—É)\n2. Wildberries (—Å –∫—ç—à–±—ç–∫–æ–º)\n3. Avito (–±/—É, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ)",
        "–ö–∞–∫ –ø—Ä–æ–π—Ç–∏ Elden Ring?": "üîπ **–°–æ–≤–µ—Ç—ã:**\n1. –ö–∞—á–∞–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å (—Ñ–∞—Ä–º–∏—Ç–µ —Ä—É–Ω—ã)\n2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ¬´–¥—É—Ö–æ–≤ –ø–µ–ø–ª–∞¬ª –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –±–æ—Å—Å–æ–≤\n3. –ò–∑—É—á–∞–π—Ç–µ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤",
    },
    "–õ–æ–≥–∏—Å—Ç—ã": {
        "–ö–∞–∫ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä –≤ –º–∞–≥–∞–∑–∏–Ω?": "üîπ **–ü—Ä–∞–≤–∏–ª–∞:**\n1. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —á–µ–∫\n2. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π\n3. –¢–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–µ\n4. –ù–∞–ø–∏—à–∏—Ç–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ",
        "–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –Ω–æ—É—Ç–±—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã?": "üîπ **–ö—Ä–∏—Ç–µ—Ä–∏–∏:**\n1. –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä: Intel Core i5/i7 –∏–ª–∏ Ryzen 5/7\n2. –û–ó–£: 16 –ì–ë (–º–∏–Ω–∏–º—É–º 8 –ì–ë)\n3. SSD: 512 –ì–ë\n4. –≠–∫—Ä–∞–Ω: IPS, 15.6 –¥—é–π–º–æ–≤",
    },
    "–î–£–ü": {
        "–ö–∞–∫ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ?": "üîπ **–°–æ–≤–µ—Ç—ã:**\n1. –ë—É–¥—å—Ç–µ –∏—Å–∫—Ä–µ–Ω–Ω–∏–º–∏ –≤ –∞–Ω–∫–µ—Ç–µ\n2. –ü–∏—à–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–µ ¬´–ü—Ä–∏–≤–µ—Ç¬ª)\n3. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –≤—Å—Ç—Ä–µ—á—É –ø–æ—Å–ª–µ –Ω–µ–¥–µ–ª–∏ –æ–±—â–µ–Ω–∏—è",
        "–ö–∞–∫ –ø–µ—Ä–µ–∂–∏—Ç—å —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏–µ?": "üîπ **–°–ø–æ—Å–æ–±—ã:**\n1. –£–¥–∞–ª–∏—Ç–µ –±—ã–≤—à–µ–≥–æ –∏–∑ —Å–æ—Ü—Å–µ—Ç–µ–π\n2. –ó–∞–π–º–∏—Ç–µ—Å—å —Å–ø–æ—Ä—Ç–æ–º\n3. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤–æ–µ —Ö–æ–±–±–∏\n4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏",
    }
}

# ====== –ë–ê–ó–ê –î–ê–ù–ù–´–• –î–õ–Ø –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ======
def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–æ–≥–æ–≤"""
    conn = sqlite3.connect(DB_PATH)  # –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS messages (
            user_id INTEGER,
            username TEXT,
            message TEXT,
            date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    conn.commit()
    conn.close()

def save_message(user_id: int, username: str, message: str):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"""
    conn = sqlite3.connect(DB_PATH)  # –ò –∑–¥–µ—Å—å —Ç–æ–∂–µ
    cursor = conn.cursor()
    cursor.execute(
        "INSERT INTO messages (user_id, username, message) VALUES (?, ?, ?)",
        (user_id, username, message)
    )
    conn.commit()
    conn.close()

# ====== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ë–û–¢–ê ======
async def log_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    user = update.message.from_user
    message_text = update.message.text
    save_message(user.id, user.username or "–Ω–µ—Ç_username", message_text)
    logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {user.id}: {message_text}")

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ - –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    await log_message(update, context)
    context.user_data.clear()
    
    categories = list(bot_data.keys())
    reply_keyboard = [categories[i:i+3] for i in range(0, len(categories), 3)]
    
    await update.message.reply_text(
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫. –í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
        reply_markup=ReplyKeyboardMarkup(
            reply_keyboard, one_time_keyboard=True, resize_keyboard=True
        ),
    )
    return CATEGORY

async def category(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    await log_message(update, context)
    user_choice = update.message.text
    
    if user_choice not in bot_data:
        await update.message.reply_text("‚ö†Ô∏è –û—à–∏–±–∫–∞: –≤—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –∫–Ω–æ–ø–æ–∫")
        return CATEGORY
    
    context.user_data['category'] = user_choice
    questions = list(bot_data[user_choice].keys())
    reply_keyboard = [questions[i:i+2] for i in range(0, len(questions), 2)]
    
    await update.message.reply_text(
        f"üóÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: <b>{user_choice}</b>\n–í—ã–±–µ—Ä–∏ –≤–æ–ø—Ä–æ—Å:",
        reply_markup=ReplyKeyboardMarkup(
            reply_keyboard, one_time_keyboard=True, resize_keyboard=True
        ),
        parse_mode="HTML"
    )
    return QUESTION

async def question(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞."""
    await log_message(update, context)
    user_choice = update.message.text
    category = context.user_data.get('category')
    
    if not category or user_choice not in bot_data[category]:
        await update.message.reply_text("‚ö†Ô∏è –û—à–∏–±–∫–∞: –≤–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return await start(update, context)
    
    answer = bot_data[category][user_choice]
    await update.message.reply_text(answer, parse_mode="Markdown")
    await update.message.reply_text("‚û°Ô∏è –•–æ—á–µ—à—å –∑–∞–¥–∞—Ç—å –µ—â—ë –≤–æ–ø—Ä–æ—Å? –ù–∞–∂–º–∏ /start")
    return ConversationHandler.END

async def cancel(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """–û—Ç–º–µ–Ω–∞ –¥–∏–∞–ª–æ–≥–∞."""
    await update.message.reply_text(
        "‚ùå –î–∏–∞–ª–æ–≥ –ø—Ä–µ—Ä–≤–∞–Ω. –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ, –Ω–∞–∂–º–∏ /start",
        reply_markup=ReplyKeyboardRemove(),
    )
    return ConversationHandler.END

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
    logger.error(f"–û—à–∏–±–∫–∞: {context.error}")

# ====== –ó–ê–ü–£–°–ö –ë–û–¢–ê ======
def main() -> None:
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞."""
    init_db()
    
    application = Application.builder().token("7704376406:AAHbpP0wCuzk8U8VJSpq0w_odkIAJbHQxoE").build()
    
    # –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∏–∞–ª–æ–≥–∞
    conv_handler = ConversationHandler(
        entry_points=[CommandHandler("start", start)],
        states={
            CATEGORY: [MessageHandler(filters.TEXT & ~filters.COMMAND, category)],
            QUESTION: [MessageHandler(filters.TEXT & ~filters.COMMAND, question)],
        },
        fallbacks=[CommandHandler("cancel", cancel)],
    )
    
    application.add_handler(conv_handler)
    application.add_error_handler(error_handler)
    application.run_polling()

if __name__ == "__main__":
    main()
